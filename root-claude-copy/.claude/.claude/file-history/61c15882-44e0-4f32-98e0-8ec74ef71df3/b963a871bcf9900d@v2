'use client'

import { useState, useEffect } from 'react'
import { NAV_HEIGHT } from '@/lib/constants'

/**
 * Hook to determine which section is currently in view
 * @param sectionIds - Array of section IDs to track
 * @returns The ID of the currently active section
 */
export function useActiveSection(sectionIds: string[]) {
  const [activeSection, setActiveSection] = useState<string>('')

  useEffect(() => {
    const handleScroll = () => {
      const scrollPosition = window.pageYOffset + NAV_HEIGHT + 100

      // Find the section that is currently in view
      for (const sectionId of sectionIds) {
        const element = document.getElementById(sectionId)
        if (element) {
          const { offsetTop, offsetHeight } = element
          if (
            scrollPosition >= offsetTop &&
            scrollPosition < offsetTop + offsetHeight
          ) {
            setActiveSection(sectionId)
            break
          }
        }
      }

      // If at the top of the page, set to first section
      if (window.pageYOffset < 100) {
        setActiveSection(sectionIds[0] || '')
      }
    }

    // Set initial active section
    handleScroll()

    window.addEventListener('scroll', handleScroll, { passive: true })

    return () => {
      window.removeEventListener('scroll', handleScroll)
    }
  }, [sectionIds])

  return activeSection
}
